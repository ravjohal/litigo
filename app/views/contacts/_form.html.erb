<%= simple_form_for(new_contact) do |f| %>
  <%= f.error_notification %>
     <% if (action_name == "index" || action_name == "companies") || (controller_name == 'dashboards' && action_name == 'new') %>
      <!--only render html from 'if' to 'end' if the controller action this form was rendered from was 'index'; reason for this is because this form is used in 'new' and 'edit' actions; reason we aren't checking for if action_name == 'new' is because this is a modal that is rendered from the index action -->
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
           <a class="close" style="padding-top: 15px;" data-dismiss="modal">Ã—</a>
            <h1>New Contact</h1>
          </div>
          <div class="modal-body">
     <% end %>

     <table class="contact-form table-condensed">
        <tbody>
            <tr>
                <td>
                    <strong>Contact Type:</strong>
                </td>
                <td>
                   <%= f.select :type, Contact::TYPES, :class => 'table-input', :selected => 'Attorney' %>
                </td>
            </tr>
            <tr id="company">
                <td>
                    <strong>Company Name:</strong>
                </td>
                <td>
                    <%= f.text_field :company_name, label: false, :class => 'table-input', placeholder: 'Allstate' %>
                </td>
            </tr>
            
            <tr id="first_name">
                <td>
                    <strong>First Name:</strong>
                </td>
                <td>
                    <%= f.text_field :first_name, label: false, :class => 'table-input', placeholder: 'John' %>
                </td>
            </tr>
            <tr id="last_name">
                <td>
                    <strong>Last Name:</strong>
                </td>
                <td>
                    <%= f.text_field :last_name, label: false, :class => 'table-input', placeholder: 'Smith' %>
                </td>
            </tr>
               <tr id='date_of_birth_field'>
                <td>
                  <strong>Date of Birth:</strong>
                </td>
                <td>
                    <%= f.date_field :date_of_birth, label: false, :class =>'table-input' %>
                </td>
            </tr>
            <tr id="ssn_field">
                <td>
                  <strong>SSN:</strong>
                </td>
                <td>
                    <%= f.text_field :ssn, label: false, class: 'table-input', placeholder: '222-22-2222' %>
                </td>
            </tr> 
               <tr>
                <td>
                    <strong>Address:</strong>
                </td>
                <td>
                    <%= f.text_field :address, label: false, :class => 'table-input', placeholder: '123 Easy St' %>
                </td>
            </tr>
            <tr>
                <td>
                    <strong>City:</strong>
                </td>
                <td>
                    <%= f.text_field :city, label: false, :class => 'table-input', placeholder: 'San Francisco' %>
                </td>
            </tr>
             <tr>
                <td>
                    <strong>State:</strong>
                </td>
                <td>
                    <%= f.select :state, us_states, label: false, :class => 'table-input', :include_blank => true %>
                </td>
            </tr>
             
              <tr>
                <td>
                    <strong>Zip Code:</strong>
                </td>
                <td>
                    <%= f.text_field :zip_code, label: false, :class => 'table-input', placeholder: '94109' %>
                </td>
            </tr>

             <tr>
                <td>
                    <strong>Phone:</strong>
                </td>
                <td>
                    <%= f.telephone_field :phone_number, label: false, :class => 'table-input', :id => 'contact_phone', placeholder: '(___) ___-___' %>
                </td>
            </tr>
             <tr id="email">
                <td>
                    <strong>Email:</strong>
                </td>
                <td>
                    <%= f.text_field :email, label: false, :class => 'table-input', placeholder: 'john.smith@gmail.com'  %>
                </td>
            </tr>
              <tr id="website">
                <td>
                    <strong>Website:</strong>
                </td>
                <td>
                    <%= f.text_field :website, label: false, :class => 'table-input', placeholder: 'www.example.com'  %>
                </td>
            </tr>
            <tr id="company_field">
                <td>
                    <strong>Company:</strong><span id="comp" title="Only existing companies can be added to a contact on this form" style="cursor: pointer; float: right; margin-right: 5px; font-size: 14px;" class="glyphicon glyphicon-question-sign"></span>
                </td>
                <td>
                    <%= f.association :company, :collection => @firm.contacts.where(:type => "Company"), :label_method => lambda {|company| "#{company.company_name}"}, :class => 'table-input', :include_blank => true, label: false %>
                </td>
            </tr>
        </tbody>
      </table>
      <br>
     <% if (action_name == "index" || action_name == "companies") || (controller_name == 'dashboards' && action_name == 'new') %>
          </div><!--end of modal-body-->
          <div class="modal-footer">
            <div class="pull-left">
              <a class="close" data-dismiss="modal">Cancel</a> 
            </div>
     <% end %>

            <div class="form-actions">
                <%= f.button :submit, :class =>"btn btn-info", :style => 'font-size: 18px;' %>
            </div>

     <% if (action_name == "index" || action_name == "companies") || (controller_name == 'dashboards' && action_name == 'new') %>
            </div><!--end of modal-footer-->
        </div><!--end of modal-content-->
      </div><!--end of modal-dialog-->
     <% end %>
<% end %>
<script>
  $(document).ready(function() { $("td select").select2(); });
  $("#new_contact").bind("ajax:error", function(evt, xhr, status, error){
    var error_text = "";
    var error_list = $.parseJSON(xhr.responseText);
    $.each(error_list, function(key, value){
      error_text = error_text + key + ": " + value.join(', ') + "</br>";
    });
    $('.alert').remove();
    $('body').append("<div class='alert alert-danger'><button type='button' class='close' data-dismiss='alert'>&#215;</button>" + error_text + "</div>");
  });
  $("#new_contact").bind("ajax:success", function(e, data, status, xhr){
    $('#modal-window').modal('hide');
    $('.alert').remove();
    $('body').append("<div class='alert alert-success'><button type='button' class='close' data-dismiss='alert'>&#215;</button>Contact was successfully created.</div>");
    var tr = $('.table').DataTable().row.add( [
          "<a href='/contacts/"+data.id+"'>"+data.last_name+" "+data.first_name+"</a>",
          data.type,
          data.email,
          data.phone_number
    ] ).draw();
    });
    $('#ssn_field').hide();
    $('#age').hide();
    $('#company').hide();
    $('#website').hide();
    $('#company_field').show();
    $('#date_of_birth_field').hide();
    $('#contact_type').on('change', function() {
        var conceptName = $('#contact_type').find(":selected").text();
        if (conceptName == 'Defendant') {
          $('#date_of_birth_field').show();
          $('#ssn_field').show();
          $('#age').show();
          $('#attorney_type_field').hide();
          $('#website').hide();
          $('#email').show();
        } else if (conceptName == 'Plaintiff') {
          $('#ssn_field').show();
          $('#date_of_birth_field').show();
          $('#age').show();
          $('#attorney_type_field').hide();
          $('#website').hide();
          $('#email').show();
        } 
        
         else if (conceptName == 'Company') {
          $('#company_field').hide();
          $('#company').show();
          $('#first_name').hide();
          $('#last_name').hide();
          $('#website').show();
          $('#email').hide();
          $('#ssn_field').hide();
          $('#date_of_birth_field').hide();
          $('#age').hide();
        } else {
          $('#ssn_field').hide();
          $('#date_of_birth_field').hide();
          $('#age').hide();
          $('#attorney_type_field').hide();
          $('#company_field').show();
          $('#company').hide();
          $('#first_name').show();
          $('#last_name').show();
          $('#website').hide();
          $('#email').show();
        }
      });
</script>
<script>
  $(document).ready(function() {
    $('#contact_phone').mask("(999) 999-9999");
    $('#contact_fax').mask("(999) 999-9999");
  });
</script>
<script type='text/javascript'>
  $(function() {
    $('#comp').tipsy({gravity: 's', fade: true});
  });
</script>
