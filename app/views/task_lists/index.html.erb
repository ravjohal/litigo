<% if params[:case_id].present? %>
  <div class="import-task-list" id="index-buttons">
    <%= link_to "Import to Case", '', {:class => "action-button", :id => "import_task_lists", :remote => true} %>
  </div>
<% end %>
<p id="notice"><%= notice %></p>
<h3>Task Lists</h3>
<table class="table table-striped table-hover rowlink">
  <thead>
  <tr>
    <th>Name</th>
    <th>View Permission</th>
    <th>Amend Permission</th>
    <th>Task Importation</th>
    <% if params[:case_id].present? %>
      <th>Import to Case</th>
    <% end %>
    <th></th>
    <th></th>
  </tr>
  </thead>

  <tbody>
  <% @task_lists.each do |task_list| %>
    <%= render 'task_list_row', task_list: task_list %>
  <% end %>
  </tbody>
</table>
<script type="text/javascript" charset="utf-8">
  var table = $('.table').dataTable({
    language: {
      search: "_INPUT_",
      searchPlaceholder: "Search or Filter",
      lengthMenu: "View _MENU_"
    },
    sDom: 'Rfrtlip',
    aaSorting: [[0, "asc"]]
  });
  $("select").select2();
  $('table.rowlink tr td:not(:nth-child(5), :nth-child(6), :nth-child(7))').click(function ()    {
    location.href = $(this).parent().find('td a').attr('href');
  });

  <% if params[:case_id].present? %>
  $('#import_task_lists').click(function (e) {
    e.preventDefault();
    var task_lists_ids = [];
    $.each($('.import_task_lists:checkbox:checked'), function (i, cb) {
      task_lists_ids.push($(cb).data('id'));
    });
    $.ajax({
      type: "POST",
      url: '/task_lists/import_to_case',
      dataType: "json",
      data: {task_list: {task_lists_ids: task_lists_ids, case_id: <%= params[:case_id] %>}},
      success: function (data, textStatus) {
        window.location.href = "<%= tasks_path %>";
        $('.alert').remove();
        $('body').append("<div class='alert alert-success'><button type='button' class='close' data-dismiss='alert'>&#215;</button>" + data.message + "</div>");
        setTimeout(function(){ $('.alert').fadeOut() }, 2000);
      }
    });
  });
    <% end %>
</script>